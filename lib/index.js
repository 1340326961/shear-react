!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("react"),require("mathjs"));else if("function"==typeof define&&define.amd)define(["react","mathjs"],e);else{var o="object"==typeof exports?e(require("react"),require("mathjs")):e(t.React,t.mathjs);for(var n in o)("object"==typeof exports?exports:t)[n]=o[n]}}(self,(function(t,e){return(()=>{"use strict";var o={698:e=>{e.exports=t},680:t=>{t.exports=e}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var c=n[t]={exports:{}};return o[t](c,c.exports,a),c.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var c={};return(()=>{a.d(c,{default:()=>m});var t=a(698),e=a.n(t),o=a(680);function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?l(t):e}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var f={left_top:"right_bottom",center_top:"center_bottom",right_top:"left_bottom",right_center:"left_center",right_bottom:"left_top",center_bottom:"center_top",left_bottom:"right_top",left_center:"right_center"},p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(d,t);var n,a,c,p,m=(c=d,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=u(c);if(p){var o=u(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return s(this,t)});function d(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),v(l(n=m.call(this,t)),"readMove",!1),v(l(n),"readSpotMove",!1),v(l(n),"mouseDownX",0),v(l(n),"mouseDownY",0),v(l(n),"cropBoxInfo",null),v(l(n),"workAreaInfo",null),v(l(n),"spotPosition",null),v(l(n),"createMoveBox",!1),v(l(n),"createBoxClient",{x:0,y:0}),v(l(n),"init",(function(){var t=n.state.aspectRatio;n.props.img&&(window.onload=function(){var e=n.activeImg.current,a=e.naturalWidth,c=e.naturalHeight,r=e.offsetWidth,i=e.offsetHeight,s=r>i?i:r;t||(t=(0,o.evaluate)("".concat(r,"/").concat(i))),n.setState({cropBoxWidth:(0,o.evaluate)("".concat(s," / 2")),cropBoxHeight:(0,o.evaluate)("".concat(s," / 2 / ").concat(t)),imgInfo:{width:a,height:c,width_style:r,height_style:i},aspectRatio:t},(function(){n.cropBoxInfo=n.moveBox.current.getBoundingClientRect(),n.workAreaInfo=n.canvasBox.current.getBoundingClientRect();var t=n.state,e=t.cropBoxWidth,a=t.cropBoxHeight;n.setState({imgW:e,imgH:a,transformX:(0,o.evaluate)("".concat(n.workAreaInfo.width," / 2 - ").concat(e," /2")),transformY:(0,o.evaluate)("".concat(n.workAreaInfo.height," / 2 -").concat(a," / 2"))})}))})})),v(l(n),"boxDown",(function(t){t.preventDefault(),t.stopPropagation();var e=t.currentTarget.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top;n.mouseDownX=o,n.mouseDownY=a,n.cropBoxInfo=e,n.readMove=!0,n.workAreaInfo=n.canvasBox.current.getBoundingClientRect(),console.log(n.workAreaInfo.top),window.addEventListener("mousemove",n.boxMove),window.addEventListener("mouseup",n.boxUp)})),v(l(n),"boxUp",(function(){n.readMove=!1,window.removeEventListener("mousemove",n.boxMove),window.removeEventListener("mouseup",n.boxUp)})),v(l(n),"boxMove",(function(t){if(n.readMove){var e=t.clientX,a=t.clientY,c=l(n),r=c.cropBoxInfo,i=c.workAreaInfo,s=(0,o.evaluate)("".concat(e," - ").concat(i.left," - ").concat(n.mouseDownX)),u=(0,o.evaluate)("".concat(a," - ").concat(i.top," - ").concat(n.mouseDownY));(0,o.evaluate)("".concat(e,"-").concat(n.mouseDownX))<i.left&&(s="0"),(0,o.evaluate)("".concat(e,"-").concat(n.mouseDownX," + ").concat(r.width))>i.right&&(s=(0,o.evaluate)("".concat(i.width,"-").concat(r.width))),(0,o.evaluate)("".concat(a,"-").concat(n.mouseDownY))<i.top&&(u="0"),(0,o.evaluate)("".concat(a,"-").concat(n.mouseDownY," + ").concat(r.height))>i.bottom&&(u=(0,o.evaluate)("".concat(i.height,"-").concat(r.height))),n.setState({transformX:s,transformY:u})}})),v(l(n),"cropImg",(function(){var t=n.state,e=t.transformX,a=t.transformY,c=n.state.imgInfo,r=c.width,i=c.height,s=c.width_style,l=c.height_style,u=n.cropBoxInfo,v=u.width,f=u.height,p=n.props.onChange,m=(0,o.evaluate)("(".concat(v," / ").concat(s,")")),d=(0,o.evaluate)("(".concat(f," / ").concat(l,")")),h=(0,o.evaluate)("(".concat(e," / ").concat(s,")")),g=(0,o.evaluate)("(".concat(a," / ").concat(l,")")),w=(0,o.evaluate)("".concat(r," * ").concat(m)),b=(0,o.evaluate)("".concat(i," * ").concat(d)),_=(0,o.evaluate)("".concat(r," * ").concat(h)),x=(0,o.evaluate)("".concat(i," * ").concat(g)),y=document.createElement("canvas");y.width=w,y.height=b,y.getContext("2d").drawImage(n.activeImg.current,_,x,w,b,0,0,w,b);var B=y.toDataURL("image/jpeg");return n.setState({img:B}),p(B),B})),v(l(n),"spotDown",(function(t,e){t.stopPropagation(),t.preventDefault(),n.readSpotMove=!0,n.spotPosition=e,n.workAreaInfo=n.canvasBox.current.getBoundingClientRect(),window.addEventListener("mousemove",n.spotMove),window.addEventListener("mouseup",n.spotUp)})),v(l(n),"spotMove",(function(t){if(n.readSpotMove){var e=n.state.aspectRatio,a=n.state,c=a.cropBoxWidth,r=a.cropBoxHeight,i=a.transformX,s=a.transformY,u=t.clientX,v=t.clientY;n.workAreaInfo=n.canvasBox.current.getBoundingClientRect();var p=l(n),m=p.spotPosition,d=p.workAreaInfo,h=0,g=0,w=0,b=0,_=0,x=0,y=!1,B=!1,M=!1,D=!1;switch(m){case"center_top":h=(0,o.evaluate)("".concat(s," - ").concat(v," + ").concat(d.top)),g=(0,o.evaluate)("".concat(h," * ").concat(e)),w=(0,o.evaluate)("".concat(s," - ").concat(h)),b=(0,o.evaluate)("".concat(i," - ").concat(g," / ",2)),x=(0,o.evaluate)("".concat(r," + ").concat(h)),_=(0,o.evaluate)("".concat(x," * ").concat(e)),y=!0;break;case"center_bottom":h=(0,o.evaluate)("".concat(v," - ").concat(d.top," - ").concat(s," - ").concat(r)),g=(0,o.evaluate)("".concat(h," * ").concat(e)),w=s,b=(0,o.evaluate)("".concat(i," - ").concat(g," / ",2)),x=(0,o.evaluate)("".concat(r," + ").concat(h)),_=(0,o.evaluate)("".concat(x," * ").concat(e)),B=!0;break;case"right_center":g=(0,o.evaluate)("".concat(u," - ").concat(d.left," - ").concat(i," - ").concat(c)),h=(0,o.evaluate)("".concat(g," / ").concat(e)),w=(0,o.evaluate)("".concat(s," - ").concat(h," / ",2)),b=i,_=(0,o.evaluate)("".concat(c," + ").concat(g)),x=(0,o.evaluate)("".concat(_," / ").concat(e)),M=!0;break;case"left_center":g=(0,o.evaluate)("".concat(i," - ").concat(u," + ").concat(d.left)),h=(0,o.evaluate)("".concat(g," / ").concat(e)),w=(0,o.evaluate)("".concat(s," - ").concat(h," / ",2)),b=(0,o.evaluate)("".concat(i," - ").concat(g)),_=(0,o.evaluate)("".concat(c," + ").concat(g)),x=(0,o.evaluate)("".concat(_," / ").concat(e)),D=!0;break;case"left_top":g=(0,o.evaluate)("".concat(i," - ").concat(u," + ").concat(d.left)),h=(0,o.evaluate)("".concat(g," / ").concat(e)),w=(0,o.evaluate)("".concat(s," - ").concat(h)),b=(0,o.evaluate)("".concat(i," - ").concat(g)),_=(0,o.evaluate)("".concat(c," + ").concat(g)),x=(0,o.evaluate)("".concat(_," / ").concat(e)),y=!0,D=!0;break;case"right_top":g=(0,o.evaluate)("".concat(u," - ").concat(i," - ").concat(d.left," - ").concat(c)),h=(0,o.evaluate)("".concat(g," / ").concat(e)),w=(0,o.evaluate)("".concat(s," - ").concat(h)),b=i,_=(0,o.evaluate)("".concat(c," + ").concat(g)),x=(0,o.evaluate)("".concat(_," / ").concat(e)),y=!0,M=!0;break;case"right_bottom":g=(0,o.evaluate)("".concat(u," - ").concat(i," - ").concat(d.left," - ").concat(c)),h=(0,o.evaluate)("".concat(g," / ").concat(e)),w=s,b=i,_=(0,o.evaluate)("".concat(c," + ").concat(g)),x=(0,o.evaluate)("".concat(_," / ").concat(e)),B=!0,M=!0;break;case"left_bottom":g=(0,o.evaluate)("".concat(i," + ").concat(d.left," - ").concat(u)),h=(0,o.evaluate)("".concat(g," / ").concat(e)),w=s,b=(0,o.evaluate)("".concat(i," - ").concat(g)),_=(0,o.evaluate)("".concat(c," + ").concat(g)),x=(0,o.evaluate)("".concat(_," / ").concat(e)),B=!0,D=!0}var k=(0,o.evaluate)("".concat(w," + ").concat(x," + ").concat(d.top))>=d.bottom,E=(0,o.evaluate)("".concat(b," + ").concat(_," + ").concat(d.left))>=d.right;w<=0&&!B||b<=0&&!M||k&&!y||E&&!D||((_<=0||x<=0)&&(n.spotPosition=f[n.spotPosition]),n.setState({cropBoxWidth:_,cropBoxHeight:x,transformX:b,transformY:w}))}})),v(l(n),"spotUp",(function(){n.readSpotMove=!1,n.cropBoxInfo=n.moveBox.current.getBoundingClientRect(),window.removeEventListener("mousemove",n.spotMove),window.removeEventListener("mouseup",n.spotUp)})),v(l(n),"workAreaMouseDown",(function(t){t.stopPropagation(),t.preventDefault(),n.createMoveBox=!0,n.readSpotMove=!0;var e=t.clientX,o=t.clientY;n.workAreaInfo=n.canvasBox.current.getBoundingClientRect(),n.createBoxClient={x:e,y:o},window.addEventListener("mousemove",n.workAreaMouseMove),window.addEventListener("mouseup",n.createMoveBoxOver)})),v(l(n),"workAreaMouseMove",(function(t){var e=n.createBoxClient,a=e.x,c=e.y,r=t.clientX,i=t.clientY;Math.abs(a-i)<10||Math.abs(c-i)<10||(n.createMoveBox?(a<r&&(n.spotPosition=c>i?"right_top":"right_bottom"),a>r&&(n.spotPosition=c<i?"left_bottom":"left_top"),n.setState({cropBoxHeight:Math.abs((0,o.evaluate)("".concat(a," - ").concat(r))),cropBoxWidth:Math.abs((0,o.evaluate)("".concat(c," - ").concat(i))),transformX:(0,o.evaluate)("".concat(a," - ").concat(n.workAreaInfo.left)),transformY:(0,o.evaluate)("".concat(c," - ").concat(n.workAreaInfo.top))},(function(){return n.spotMove(t)}))):n.spotMove(t),n.createMoveBox&&(n.createMoveBox=!1))})),v(l(n),"createMoveBoxOver",(function(){n.createBoxClient=null,n.readSpotMove=!1,window.removeEventListener("mousemove",n.workAreaMouseMove),window.removeEventListener("mouseup",n.createMoveBoxOver)})),n.canvasBox=e().createRef(),n.moveBox=e().createRef(),n.activeImg=e().createRef(),n.state={img:null,transformX:0,transformY:0,cropBoxWidth:0,cropBoxHeight:0,imgW:0,imgH:0,imgInfo:null,aspectRatio:t.aspectRatio},n}return n=d,(a=[{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var t=this,o=this.state,n=o.transformX,a=o.transformY,c=o.cropBoxHeight,r=o.cropBoxWidth,i=o.imgInfo,s=(o.imgW,o.imgH,this.props),l=s.img,u=s.crossOrigin,v=s.width,f=s.height,p=s.cropBoxColor;return l?e().createElement("div",{className:"App",style:{width:v,height:f}},e().createElement("div",{className:"canvas_box",ref:this.canvasBox,onMouseDown:this.workAreaMouseDown},u?e().createElement("img",{ref:this.activeImg,crossOrigin:u,className:"canvas",src:l,alt:"图片"}):e().createElement("img",{ref:this.activeImg,className:"canvas",src:l,alt:"图片"}),e().createElement("div",{className:"modal"}),i?e().createElement("div",{ref:this.moveBox,style:{width:r,height:c,transform:"translate(".concat(n,"px,").concat(a,"px)")},className:"move_box",onMouseDown:this.boxDown},e().createElement("div",{className:"move_img_box"},e().createElement("img",{alt:"图片",style:{width:i.width_style,height:i.height_style,transform:"translate(-".concat(n,"px,-").concat(a,"px)")},src:l})),e().createElement("div",{style:{backgroundColor:p},className:"line_top line",onMouseDown:function(e){return t.spotDown(e,"center_top")}}),e().createElement("div",{style:{backgroundColor:p},className:"line_right line",onMouseDown:function(e){return t.spotDown(e,"right_center")}}),e().createElement("div",{style:{backgroundColor:p},className:"line_bottom line",onMouseDown:function(e){return t.spotDown(e,"center_bottom")}}),e().createElement("div",{style:{backgroundColor:p},className:"line_left line",onMouseDown:function(e){return t.spotDown(e,"left_center")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_left_top",onMouseDown:function(e){return t.spotDown(e,"left_top")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_center_top",onMouseDown:function(e){return t.spotDown(e,"center_top")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_right_top",onMouseDown:function(e){return t.spotDown(e,"right_top")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_right_center",onMouseDown:function(e){return t.spotDown(e,"right_center")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_right_bottom",onMouseDown:function(e){return t.spotDown(e,"right_bottom")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_center_bottom",onMouseDown:function(e){return t.spotDown(e,"center_bottom")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_left_bottom",onMouseDown:function(e){return t.spotDown(e,"left_bottom")}}),e().createElement("div",{style:{backgroundColor:p},className:"spot spot_left_center",onMouseDown:function(e){return t.spotDown(e,"left_center")}})):null)):e().createElement("div",null,"请传入图片链接")}}])&&r(n.prototype,a),d}(e().Component);v(p,"defaultProps",{img:null,aspectRatio:null,crossOrigin:!1,width:"100%",height:"auto",onChange:function(){},cropBoxColor:"hotpink"});const m=p})(),c.default})()}));