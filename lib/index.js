!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("react"),require("mathjs"));else if("function"==typeof define&&define.amd)define(["react","mathjs"],e);else{var o="object"==typeof exports?e(require("react"),require("mathjs")):e(t.React,t.mathjs);for(var n in o)("object"==typeof exports?exports:t)[n]=o[n]}}(self,(function(t,e){return(()=>{"use strict";var o={698:e=>{e.exports=t},680:t=>{t.exports=e}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var c=n[t]={exports:{}};return o[t](c,c.exports,a),c.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var c={};return(()=>{a.d(c,{default:()=>m});var t=a(698),e=a.n(t),o=a(680);function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var f={left_top:"right_bottom",center_top:"center_bottom",right_top:"left_bottom",right_center:"left_center",right_bottom:"left_top",center_bottom:"center_top",left_bottom:"right_top",left_center:"right_center"},p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(h,t);var n,a,c,p,m=(c=h,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=l(c);if(p){var o=l(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return s(this,t)});function h(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),v(u(n=m.call(this,t)),"readMove",!1),v(u(n),"readSpotMove",!1),v(u(n),"mouseDownX",0),v(u(n),"mouseDownY",0),v(u(n),"cropBoxInfo",null),v(u(n),"workAreaInfo",null),v(u(n),"spotPosition",null),v(u(n),"createMoveBox",!1),v(u(n),"createBoxClient",{x:0,y:0}),v(u(n),"init",(function(){var t=n.state.aspectRatio;n.props.img&&(window.onload=function(){var e=n.activeImg.current,a=e.naturalWidth,c=e.naturalHeight,r=e.offsetWidth,i=e.offsetHeight,s=r>i?i:r;t||(t=(0,o.evaluate)("".concat(r,"/").concat(i))),n.setState({cropBoxWidth:(0,o.evaluate)("".concat(s," / 2")),cropBoxHeight:(0,o.evaluate)("".concat(s," / 2 / ").concat(t)),imgInfo:{width:a,height:c,width_style:r,height_style:i},aspectRatio:t},(function(){n.cropBoxInfo=n.moveBox.current.getBoundingClientRect(),n.workAreaInfo=n.canvasBox.current.getBoundingClientRect();var t=n.state,e=t.cropBoxWidth,a=t.cropBoxHeight;console.log(e,a),n.setState({imgW:e,imgH:a,transformX:(0,o.evaluate)("".concat(n.workAreaInfo.width," / 2 - ").concat(e," /2")),transformY:(0,o.evaluate)("".concat(n.workAreaInfo.height," / 2 -").concat(a," / 2"))})}))})})),v(u(n),"boxDown",(function(t){t.preventDefault(),t.stopPropagation();var e=t.currentTarget.getBoundingClientRect(),o=t.clientX-e.left,a=t.clientY-e.top;n.mouseDownX=o,n.mouseDownY=a,n.cropBoxInfo=e,n.readMove=!0,window.addEventListener("mousemove",n.boxMove),window.addEventListener("mouseup",n.boxUp)})),v(u(n),"boxUp",(function(){n.readMove=!1,window.removeEventListener("mousemove",n.boxMove),window.removeEventListener("mouseup",n.boxUp)})),v(u(n),"boxMove",(function(t){if(n.readMove){var e=t.clientX,a=t.clientY,c=u(n),r=c.cropBoxInfo,i=c.workAreaInfo,s=(0,o.evaluate)("".concat(e," - ").concat(n.workAreaInfo.left," - ").concat(n.mouseDownX)),l=(0,o.evaluate)("".concat(a," - ").concat(n.workAreaInfo.top," - ").concat(n.mouseDownY));(0,o.evaluate)("".concat(e,"-").concat(n.mouseDownX))<i.left&&(s="0"),(0,o.evaluate)("".concat(e,"-").concat(n.mouseDownX," + ").concat(r.width))>i.right&&(s=(0,o.evaluate)("".concat(i.width,"-").concat(r.width))),(0,o.evaluate)("".concat(a,"-").concat(n.mouseDownY))<i.top&&(l="0"),(0,o.evaluate)("".concat(a,"-").concat(n.mouseDownY," + ").concat(r.height))>i.bottom&&(l=(0,o.evaluate)("".concat(i.height,"-").concat(r.height))),n.setState({transformX:s,transformY:l})}})),v(u(n),"cropImg",(function(){var t=n.state,e=t.transformX,a=t.transformY,c=n.state.imgInfo,r=c.width,i=c.height,s=c.width_style,u=c.height_style,l=n.cropBoxInfo,v=l.width,f=l.height,p=n.props.onChange,m=(0,o.evaluate)("(".concat(v," / ").concat(s,")")),h=(0,o.evaluate)("(".concat(f," / ").concat(u,")")),d=(0,o.evaluate)("(".concat(e," / ").concat(s,")")),w=(0,o.evaluate)("(".concat(a," / ").concat(u,")")),g=(0,o.evaluate)("".concat(r," * ").concat(m)),_=(0,o.evaluate)("".concat(i," * ").concat(h)),b=(0,o.evaluate)("".concat(r," * ").concat(d)),x=(0,o.evaluate)("".concat(i," * ").concat(w)),y=document.createElement("canvas");y.width=g,y.height=_,y.getContext("2d").drawImage(n.activeImg.current,b,x,g,_,0,0,g,_);var M=y.toDataURL("image/jpeg");return n.setState({img:M}),p(M),M})),v(u(n),"spotDown",(function(t,e){t.stopPropagation(),t.preventDefault(),n.readSpotMove=!0,n.spotPosition=e,window.addEventListener("mousemove",n.spotMove),window.addEventListener("mouseup",n.spotUp)})),v(u(n),"spotMove",(function(t){if(n.readSpotMove){var e=n.state,a=e.sizeChangeW,c=e.sizeChangeH,r=n.state.aspectRatio,i=n.state,s=i.cropBoxWidth,l=i.cropBoxHeight,v=i.transformX,p=i.transformY,m=t.clientX,h=t.clientY,d=u(n),w=d.spotPosition,g=d.workAreaInfo,_=0,b=0,x=0,y=0,M=0,D=0,B=!1,E=!1,I=!1,k=!1;switch(w){case"center_top":_=(0,o.evaluate)("".concat(p," - ").concat(h," + ").concat(g.top)),b=(0,o.evaluate)("".concat(_," * ").concat(r)),x=(0,o.evaluate)("".concat(p," - ").concat(_)),y=(0,o.evaluate)("".concat(v," - ").concat(b," / ",2)),D=(0,o.evaluate)("".concat(l," + ").concat(_)),M=(0,o.evaluate)("".concat(D," * ").concat(r)),B=!0;break;case"center_bottom":_=(0,o.evaluate)("".concat(h," - ").concat(g.top," - ").concat(p," - ").concat(l)),b=(0,o.evaluate)("".concat(_," * ").concat(r)),x=p,y=(0,o.evaluate)("".concat(v," - ").concat(b," / ",2)),D=(0,o.evaluate)("".concat(l," + ").concat(_)),M=(0,o.evaluate)("".concat(D," * ").concat(r)),E=!0;break;case"right_center":b=(0,o.evaluate)("".concat(m," - ").concat(g.left," - ").concat(v," - ").concat(s)),_=(0,o.evaluate)("".concat(b," / ").concat(r)),x=(0,o.evaluate)("".concat(p," - ").concat(_," / ",2)),y=v,M=(0,o.evaluate)("".concat(s," + ").concat(b)),D=(0,o.evaluate)("".concat(M," / ").concat(r)),I=!0;break;case"left_center":b=(0,o.evaluate)("".concat(v," - ").concat(m," + ").concat(g.left)),_=(0,o.evaluate)("".concat(b," / ").concat(r)),x=(0,o.evaluate)("".concat(p," - ").concat(_," / ",2)),y=(0,o.evaluate)("".concat(v," - ").concat(b)),M=(0,o.evaluate)("".concat(s," + ").concat(b)),D=(0,o.evaluate)("".concat(M," / ").concat(r)),k=!0;break;case"left_top":b=(0,o.evaluate)("".concat(v," - ").concat(m," + ").concat(g.left)),_=(0,o.evaluate)("".concat(b," / ").concat(r)),x=(0,o.evaluate)("".concat(p," - ").concat(_)),y=(0,o.evaluate)("".concat(v," - ").concat(b)),M=(0,o.evaluate)("".concat(s," + ").concat(b)),D=(0,o.evaluate)("".concat(M," / ").concat(r)),B=!0,k=!0;break;case"right_top":b=(0,o.evaluate)("".concat(m," - ").concat(v," - ").concat(g.left," - ").concat(s)),_=(0,o.evaluate)("".concat(b," / ").concat(r)),x=(0,o.evaluate)("".concat(p," - ").concat(_)),y=v,M=(0,o.evaluate)("".concat(s," + ").concat(b)),D=(0,o.evaluate)("".concat(M," / ").concat(r)),B=!0,I=!0;break;case"right_bottom":b=(0,o.evaluate)("".concat(m," - ").concat(v," - ").concat(g.left," - ").concat(s)),_=(0,o.evaluate)("".concat(b," / ").concat(r)),x=p,y=v,M=(0,o.evaluate)("".concat(s," + ").concat(b)),D=(0,o.evaluate)("".concat(M," / ").concat(r)),E=!0,I=!0;break;case"left_bottom":b=(0,o.evaluate)("".concat(v," + ").concat(g.left," - ").concat(m)),_=(0,o.evaluate)("".concat(b," / ").concat(r)),x=p,y=(0,o.evaluate)("".concat(v," - ").concat(b)),M=(0,o.evaluate)("".concat(s," + ").concat(b)),D=(0,o.evaluate)("".concat(M," / ").concat(r)),E=!0,k=!0}var O=(0,o.evaluate)("".concat(x," + ").concat(D," + ").concat(g.top))>=g.bottom,R=(0,o.evaluate)("".concat(y," + ").concat(M," + ").concat(g.left))>=g.right;if(!(x<=0&&!E||y<=0&&!I||O&&!B||R&&!k))return M<=0||D<=0?n.spotPosition=f[n.spotPosition]:void n.setState({cropBoxWidth:M,cropBoxHeight:D,transformX:y,transformY:x,sizeChangeW:a+b,sizeChangeH:c+_})}})),v(u(n),"spotUp",(function(){n.readSpotMove=!1,n.cropBoxInfo=n.moveBox.current.getBoundingClientRect(),window.removeEventListener("mousemove",n.spotMove),window.removeEventListener("mouseup",n.spotUp)})),v(u(n),"workAreaMouseDown",(function(t){t.stopPropagation(),t.preventDefault(),n.createMoveBox=!0,n.readSpotMove=!0;var e=t.clientX,o=t.clientY;n.createBoxClient={x:e,y:o},window.addEventListener("mousemove",n.workAreaMouseMove),window.addEventListener("mouseup",n.createMoveBoxOver)})),v(u(n),"workAreaMouseMove",(function(t){var e=n.createBoxClient,a=e.x,c=e.y,r=t.clientX,i=t.clientY;Math.abs(a-i)<10||Math.abs(c-i)<10||(n.createMoveBox?(a<r&&(n.spotPosition=c>i?"right_top":"right_bottom"),a>r&&(n.spotPosition=c<i?"left_bottom":"left_top"),n.setState({cropBoxHeight:Math.abs((0,o.evaluate)("".concat(a," - ").concat(r))),cropBoxWidth:Math.abs((0,o.evaluate)("".concat(c," - ").concat(i))),transformX:(0,o.evaluate)("".concat(a," - ").concat(n.workAreaInfo.left)),transformY:(0,o.evaluate)("".concat(c," - ").concat(n.workAreaInfo.top))},(function(){return n.spotMove(t)}))):n.spotMove(t),n.createMoveBox&&(n.createMoveBox=!1))})),v(u(n),"createMoveBoxOver",(function(){n.createBoxClient=null,n.readSpotMove=!1,window.removeEventListener("mousemove",n.workAreaMouseMove),window.removeEventListener("mouseup",n.createMoveBoxOver)})),n.canvasBox=e().createRef(),n.moveBox=e().createRef(),n.activeImg=e().createRef(),n.state={img:null,transformX:0,transformY:0,cropBoxWidth:0,cropBoxHeight:0,imgW:0,imgH:0,imgInfo:null,sizeChangeW:0,sizeChangeH:0,aspectRatio:t.aspectRatio},n}return n=h,(a=[{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var t=this,o=this.state,n=o.transformX,a=o.transformY,c=o.cropBoxHeight,r=o.cropBoxWidth,i=o.imgInfo,s=(o.imgW,o.imgH,this.props),u=s.img,l=s.crossOrigin,v=s.width,f=s.height;return u?e().createElement("div",{className:"App",style:{width:v,height:f}},e().createElement("div",{className:"canvas_box",ref:this.canvasBox,onMouseDown:this.workAreaMouseDown},l?e().createElement("img",{ref:this.activeImg,crossOrigin:l,className:"canvas",src:u,alt:"图片"}):e().createElement("img",{ref:this.activeImg,className:"canvas",src:u,alt:"图片"}),e().createElement("div",{className:"modal"}),i?e().createElement("div",{ref:this.moveBox,style:{width:r,height:c,transform:"translate(".concat(n,"px,").concat(a,"px)")},className:"move_box",onMouseDown:this.boxDown},e().createElement("div",{className:"move_img_box"},e().createElement("img",{alt:"图片",style:{width:i.width_style,height:i.height_style,transform:"translate(-".concat(n,"px,-").concat(a,"px)")},src:u})),e().createElement("div",{className:"line_top line",onMouseDown:function(e){return t.spotDown(e,"center_top")}}),e().createElement("div",{className:"line_right line",onMouseDown:function(e){return t.spotDown(e,"right_center")}}),e().createElement("div",{className:"line_bottom line",onMouseDown:function(e){return t.spotDown(e,"center_bottom")}}),e().createElement("div",{className:"line_left line",onMouseDown:function(e){return t.spotDown(e,"left_center")}}),e().createElement("div",{className:"spot spot_left_top",onMouseDown:function(e){return t.spotDown(e,"left_top")}}),e().createElement("div",{className:"spot spot_center_top",onMouseDown:function(e){return t.spotDown(e,"center_top")}}),e().createElement("div",{className:"spot spot_right_top",onMouseDown:function(e){return t.spotDown(e,"right_top")}}),e().createElement("div",{className:"spot spot_right_center",onMouseDown:function(e){return t.spotDown(e,"right_center")}}),e().createElement("div",{className:"spot spot_right_bottom",onMouseDown:function(e){return t.spotDown(e,"right_bottom")}}),e().createElement("div",{className:"spot spot_center_bottom",onMouseDown:function(e){return t.spotDown(e,"center_bottom")}}),e().createElement("div",{className:"spot spot_left_bottom",onMouseDown:function(e){return t.spotDown(e,"left_bottom")}}),e().createElement("div",{className:"spot spot_left_center",onMouseDown:function(e){return t.spotDown(e,"left_center")}})):null)):e().createElement("div",null,"请传入图片链接")}}])&&r(n.prototype,a),h}(e().Component);v(p,"defaultProps",{img:null,aspectRatio:null,crossOrigin:!1,width:"100%",height:"auto",onChange:function(){}});const m=p})(),c.default})()}));